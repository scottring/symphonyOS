# V1.5 Capture â†’ Triage Flow + Desktop/Mobile Split

## Philosophy

**Capture and triage are separate moments.**

- **Capture:** Brain dump. Zero friction. Get it out of your head.
- **Triage:** Review. Decide when, what context, who owns it. Happens later.

This follows GTD's "ubiquitous capture" principle and aligns with Symphony's "plan on desktop, execute on mobile" philosophy.

**Planning rhythm emerges from the UI:**
| When | What happens |
|------|--------------|
| **Continuous** | See inbox item, quick triage via icons |
| **Daily review** | What's still in inbox? Process or defer |
| **Weekly planning** | Review deferred items, plan the week |

---

## Current Problems

1. **QuickCapture is overloaded** (~900 lines, 12+ states)
2. **No clear "inbox" concept** â€” unscheduled tasks aren't surfaced for review
3. **Desktop/mobile use same treatment** â€” DetailPanel serves both (cramped on desktop)
4. **Triage UI is noisy** â€” all buttons visible at once is overwhelming

---

## Target State

### QuickCapture (Simplified)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  What's on your mind?               â”‚  â† text-2xl font-display (Fraunces)
â”‚                                     â”‚
â”‚           [Cancel]  [Save]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**That's it.** No modes, no @/#, no date parsing, no voice.

Tasks created here:
- Have a title
- `scheduled_for` = null (inbox)
- `context` = null
- `project_id` = null
- `assigned_to` = null
- Appear in the **Inbox section**

### Today View Structure

**Inbox at BOTTOM** (you review scheduled items first, then what's left):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Today Â· Wed, Dec 3          < > â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ ALL DAY                          â”‚
â”‚    ğŸŸ¢ Dinner: baked potato bar      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ MORNING                          â”‚
â”‚    ğŸŸ¢ 9:30a Meeting with team       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ AFTERNOON                        â”‚
â”‚    â—‹ Call dentist             ğŸ“…ğŸ·ï¸ğŸ‘¤ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ EVENING                          â”‚
â”‚    ğŸŸ¢ 6p Pack & Den Meeting         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â˜ INBOX (3)                        â”‚  â† At bottom
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â—‹ Look for the moxie        ğŸ“…ğŸ·ï¸ğŸ‘¤ â”‚
â”‚    #Get to 185                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â—‹ Research SF flights       ğŸ“…ğŸ·ï¸ğŸ‘¤ â”‚
â”‚    #Plan SFO Spring Break           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Card Anatomy â€” Tasks (Inbox + Scheduled)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—‹ Task title here                    ğŸ“…  ğŸ·ï¸  ğŸ‘¤ â”‚
â”‚   #Project Name Ã—                               â”‚
â”‚   @Assigned Person Ã—                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Icon buttons (right-aligned):**
- **ğŸ“…** (calendar icon) â†’ When: Expands to [Today] [Tomorrow] [Next Week] [Someday] [+Date]
- **ğŸ·ï¸** (tag icon) â†’ Context: Expands to [Work] [Family] [Personal]
- **ğŸ‘¤** (person icon) â†’ Assign: Opens contact picker

**Behavior:**
- Icons are always visible, quiet when not active
- Tap icon â†’ expands popover/dropdown with options
- Selection collapses popover, updates card
- Project and assignee show as chips below title (if set)

### Which Cards Get Icons?

| Card Type | ğŸ“… When | ğŸ·ï¸ Context | ğŸ‘¤ Assign | Notes |
|-----------|---------|------------|-----------|-------|
| **Inbox task** | âœ… | âœ… | âœ… | Full triage |
| **Scheduled task** | âœ… | âœ… | âœ… | Can reschedule/edit |
| **Calendar event** | âŒ | âŒ | âŒ | Read-only from Google |
| **Routine** | âŒ | âŒ | âŒ | Personal habits (for now) |

Events and routines stay simple. Full triage is for tasks only.

### Desktop/Mobile Split

| Context | Task Click | Full Edit |
|---------|------------|-----------|
| **Desktop (â‰¥768px)** | TaskView page | TaskView page |
| **Mobile (<768px)** | DetailPanel modal | DetailPanel modal |

---

## Data Model Updates

### Task Type

```typescript
export type TaskContext = 'work' | 'family' | 'personal' | null

export interface Task {
  id: string
  title: string
  completed: boolean
  scheduled_for: Date | null      // null = inbox
  context: TaskContext            // NEW (renamed from domain)
  project_id: string | null
  contact_id: string | null       // Who task is ABOUT (e.g., "Call Dr. Smith")
  assigned_to: string | null      // Who should DO it (e.g., Iris) â€” NEW
  created_at: Date
  updated_at: Date
}
```

**Important distinction:**
- `contact_id` = Related person (who is this task *about*?)
- `assigned_to` = Owner (who should *do* this task?)

Both reference the contacts table for now. True multi-user sharing comes later.

### Database Migration

```sql
-- Add context field (renamed from domain for clarity)
ALTER TABLE tasks 
ADD COLUMN context TEXT CHECK (context IN ('work', 'family', 'personal'));

-- Add assigned_to field (separate from contact_id)
ALTER TABLE tasks
ADD COLUMN assigned_to UUID REFERENCES contacts(id);
```

---

## Implementation Tasks

### Phase 1: Database + Types

1. Create migration: add `context` and `assigned_to` columns
2. Update Task type in `src/types/task.ts`
3. Update `useSupabaseTasks.ts` to handle new fields

### Phase 2: Simplify QuickCapture

**File:** `src/components/layout/QuickCapture.tsx`

Strip to ~100-150 lines:
- Title input only (`text-2xl font-display`)
- Cancel + Save buttons
- Remove: mode toggle, @/#, date parsing, voice, contact/project pickers

### Phase 3: Create Triage Icon Components

**File:** `src/components/triage/WhenPicker.tsx`

```tsx
interface WhenPickerProps {
  onSelect: (date: Date | 'next-week' | 'someday') => void
}

// Calendar icon that expands to:
// [Today] [Tomorrow] [Next Week] [Someday] [+Date]
```

**File:** `src/components/triage/ContextPicker.tsx`

```tsx
interface ContextPickerProps {
  value: TaskContext
  onChange: (context: TaskContext) => void
}

// Tag icon that expands to:
// [Work] [Family] [Personal]
```

**File:** `src/components/triage/AssignPicker.tsx`

```tsx
interface AssignPickerProps {
  value: string | null  // contact id
  contacts: Contact[]
  onChange: (contactId: string | null) => void
}

// Person icon that opens contact picker
```

### Phase 4: Create Task Card Components

**File:** `src/components/schedule/TaskCard.tsx`

Universal task card used in both inbox and scheduled sections:
- Checkbox, title, icons (right-aligned)
- Project chip (if set)
- Assignee chip (if set)
- Click title â†’ opens TaskView (desktop) or DetailPanel (mobile)

### Phase 5: Create Inbox Section

**File:** `src/components/schedule/InboxSection.tsx`

- Shows tasks where `scheduled_for` is null
- Renders at BOTTOM of TodaySchedule
- Header: "â˜ INBOX (n)"
- Each task renders as TaskCard with full triage icons

### Phase 6: Update TodaySchedule

**File:** `src/components/schedule/TodaySchedule.tsx`

- Separate inbox tasks from scheduled tasks
- Render scheduled sections first (All Day, Morning, Afternoon, Evening)
- Render InboxSection last (at bottom)
- Pass triage handlers to TaskCard

### Phase 7: Create useIsMobile Hook

**File:** `src/hooks/useIsMobile.ts`

```tsx
export function useIsMobile(breakpoint = 768) {
  const [isMobile, setIsMobile] = useState(
    typeof window !== 'undefined' ? window.innerWidth < breakpoint : false
  )
  useEffect(() => {
    const handler = () => setIsMobile(window.innerWidth < breakpoint)
    window.addEventListener('resize', handler)
    return () => window.removeEventListener('resize', handler)
  }, [breakpoint])
  return isMobile
}
```

### Phase 8: Create TaskView Component

**File:** `src/components/task/TaskView.tsx`

Full-page task view for desktop:
- Header: back button, large editable title (`text-2xl font-display`), delete button
- Completion toggle
- When picker (date)
- Context picker (Work/Family/Personal)
- Assign picker
- Project picker
- Contact picker (who task is about)
- Notes field (prep for V1.6)

### Phase 9: Wire Up Responsive Routing

**File:** `src/App.tsx`

- Use `useIsMobile()` hook
- Desktop: task click â†’ `setSelectedTaskId()` â†’ render TaskView
- Mobile: task click â†’ `setSelectedItemId()` â†’ render DetailPanel modal

---

## Files to Create

- `src/components/triage/WhenPicker.tsx`
- `src/components/triage/ContextPicker.tsx`
- `src/components/triage/AssignPicker.tsx`
- `src/components/schedule/TaskCard.tsx`
- `src/components/schedule/InboxSection.tsx`
- `src/components/task/TaskView.tsx`
- `src/hooks/useIsMobile.ts`
- `supabase/migrations/xxx_add_context_and_assigned_to.sql`

## Files to Modify

- `src/types/task.ts` â€” Add context, assigned_to fields
- `src/hooks/useSupabaseTasks.ts` â€” Handle new fields
- `src/components/layout/QuickCapture.tsx` â€” Massive simplification
- `src/components/schedule/TodaySchedule.tsx` â€” Integrate inbox at bottom
- `src/App.tsx` â€” Responsive routing, simplified QuickCapture props

---

## Icon Suggestions (Lucide React)

```tsx
import { Calendar, Tag, User } from 'lucide-react'

// ğŸ“… When
<Calendar className="w-4 h-4" />

// ğŸ·ï¸ Context  
<Tag className="w-4 h-4" />

// ğŸ‘¤ Assign
<User className="w-4 h-4" />
```

---

## Future Enhancements (Not in This Spec)

1. **"Next Week" bucket** â€” Items deferred to weekly planning
2. **"Someday" list** â€” Items with no timeline
3. **Daily review prompt** â€” If inbox isn't empty at end of day
4. **Weekly planning view** â€” Review deferred items
5. **Calendar event context/assignment** â€” When useful
6. **Routine assignment** â€” "Iris handles trash on Tuesdays"
7. **True multi-user** â€” Shared family tasks, Iris has her own view

---

## Testing Notes

**Do NOT write tests yet.** This is architectural work.

**Manual testing checklist:**
- [ ] QuickCapture: Only title input, large serif font
- [ ] QuickCapture: Creates task with all null fields (inbox)
- [ ] Inbox section appears at BOTTOM of Today view
- [ ] Inbox hidden when empty
- [ ] Task cards show ğŸ“… ğŸ·ï¸ ğŸ‘¤ icons right-aligned
- [ ] ğŸ“… icon expands to date options
- [ ] ğŸ·ï¸ icon expands to context options
- [ ] ğŸ‘¤ icon opens contact picker
- [ ] Project/assignee chips appear below title
- [ ] Desktop: Click task â†’ TaskView page
- [ ] Mobile: Click task â†’ DetailPanel modal
- [ ] TaskView: Full editing works

---

## Execution Order

1. Database migration (context + assigned_to)
2. Update Task type
3. Simplify QuickCapture
4. Create triage picker components (When, Context, Assign)
5. Create TaskCard component
6. Create InboxSection component
7. Update TodaySchedule (inbox at bottom)
8. Create useIsMobile hook
9. Create TaskView component
10. Wire up responsive routing
11. Manual testing
